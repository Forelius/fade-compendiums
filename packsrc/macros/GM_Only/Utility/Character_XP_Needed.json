{
  "folder": "8QnG4j2FXrIxRegn",
  "name": "Character XP Needed",
  "type": "script",
  "author": "0eyrbleKg5gmY59g",
  "img": "icons/svg/up.svg",
  "scope": "global",
  "command": "// Foundry VTT v12 Macro: Compact XP Layout with Commas\n(async () => {\n  // Grab all 'class' items from the World\n  const classItems = game.items.filter(i => i.type === \"class\");\n\n  let output = \"<h2>XP Needed</h2><ul>\";\n\n  for (const token of canvas.tokens.placeables) {\n    const actor = token.actor;\n    if (!actor || actor.type !== \"character\") continue;\n\n    const className = actor.system?.details?.class;\n    const level = actor.system?.details?.level ?? 1;\n    if (!className) continue;\n\n    // Find the matching class item\n    const classItem = classItems.find(i => i.name === className);\n    if (!classItem) {\n      console.warn(`No class item found for: ${className}`);\n      continue;\n    }\n\n    // Pull the \"levels\" array\n    const levelsArray = classItem.system?.levels ?? [];\n    const currentLevelData = levelsArray.find(l => l.level === level);\n    if (!currentLevelData) {\n      console.warn(`No level data for level ${level} in class ${className}`);\n      continue;\n    }\n\n    // Determine prevXP (0 if level=1, else XP of (level-1))\n    let prevXP = 0;\n    if (level > 1) {\n      const prevLevelData = levelsArray.find(l => l.level === (level - 1));\n      if (prevLevelData) prevXP = prevLevelData.xp;\n    }\n\n    // Determine nextXP (if it exists)\n    const nextLevelData = levelsArray.find(l => l.level === (level + 1));\n    if (!nextLevelData) {\n      // Possibly max level\n      output += `\n        <li><strong>${actor.name}</strong> (Level ${level}):\n          No higher level data (max level?)\n        </li>`;\n      continue;\n    }\n\n    const nextXP = nextLevelData.xp;\n    const difference = nextXP - prevXP;\n    const oneTwentieth = Math.floor(difference / 20);\n\n    // Use toLocaleString() to add commas\n    const currentXPStr    = actor.system.details.xp.value.toLocaleString();\n    const nextXPStr       = nextXP.toLocaleString();\n    const differenceStr   = difference.toLocaleString();\n    const oneTwentiethStr = oneTwentieth.toLocaleString();\n\n    // Format a single line of info\n    output += `\n      <li>\n        <strong>${actor.name}</strong> (Level ${level}/XP ${currentXPStr})<br/>\n        Next XP: ${nextXPStr} |\n        Needed: ${differenceStr}<br/>\n        1/20: <strong>${oneTwentiethStr}</strong>\n      </li>`;\n  }\n\n  output += \"</ul>\";\n\n  // Whisper to GM(s)\n  ChatMessage.create({\n    content: output,\n    whisper: ChatMessage.getWhisperRecipients(\"GM\")\n  });\n})();",
  "ownership": {
    "default": 0,
    "0eyrbleKg5gmY59g": 3
  },
  "flags": {},
  "_stats": {
    "systemId": "fantastic-depths"
  },
  "_id": "m7uUovHzOsqO1V1Q",
  "sort": 400000,
  "_originalKey": "!macros!m7uUovHzOsqO1V1Q"
}